<!DOCTYPE html>
<html>
<head>
<title>Spring Boot简介</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
/* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */
/* Author: Nicolas Hery - http://nicolashery.com */
/* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */
/* Source: https://github.com/nicolahery/markdownpad-github */

/* RESET
=============================================================================*/

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
}

/* BODY
=============================================================================*/

body {
  font-family: Helvetica, arial, freesans, clean, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
  padding: 20px;
  max-width: 960px;
  margin: 0 auto;
}

body>*:first-child {
  margin-top: 0 !important;
}

body>*:last-child {
  margin-bottom: 0 !important;
}

/* BLOCKS
=============================================================================*/

p, blockquote, ul, ol, dl, table, pre {
  margin: 15px 0;
}

/* HEADERS
=============================================================================*/

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
}

h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {
  font-size: inherit;
}

h1 {
  font-size: 28px;
  color: #000;
}

h2 {
  font-size: 24px;
  border-bottom: 1px solid #ccc;
  color: #000;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777;
  font-size: 14px;
}

body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {
  margin-top: 0;
  padding-top: 0;
}

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}

h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {
  margin-top: 10px;
}

/* LINKS
=============================================================================*/

a {
  color: #4183C4;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* LISTS
=============================================================================*/

ul, ol {
  padding-left: 30px;
}

ul li > :first-child, 
ol li > :first-child, 
ul li ul:first-of-type, 
ol li ol:first-of-type, 
ul li ol:first-of-type, 
ol li ul:first-of-type {
  margin-top: 0px;
}

ul ul, ul ol, ol ol, ol ul {
  margin-bottom: 0;
}

dl {
  padding: 0;
}

dl dt {
  font-size: 14px;
  font-weight: bold;
  font-style: italic;
  padding: 0;
  margin: 15px 0 5px;
}

dl dt:first-child {
  padding: 0;
}

dl dt>:first-child {
  margin-top: 0px;
}

dl dt>:last-child {
  margin-bottom: 0px;
}

dl dd {
  margin: 0 0 15px;
  padding: 0 15px;
}

dl dd>:first-child {
  margin-top: 0px;
}

dl dd>:last-child {
  margin-bottom: 0px;
}

/* CODE
=============================================================================*/

pre, code, tt {
  font-size: 12px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
}

code, tt {
  margin: 0 0px;
  padding: 0px 0px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre>code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #ccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

pre code, pre tt {
  background-color: transparent;
  border: none;
}

kbd {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    background-color: #DDDDDD;
    background-image: linear-gradient(#F1F1F1, #DDDDDD);
    background-repeat: repeat-x;
    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
    border-image: none;
    border-radius: 2px 2px 2px 2px;
    border-style: solid;
    border-width: 1px;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

/* QUOTES
=============================================================================*/

blockquote {
  border-left: 4px solid #DDD;
  padding: 0 15px;
  color: #777;
}

blockquote>:first-child {
  margin-top: 0px;
}

blockquote>:last-child {
  margin-bottom: 0px;
}

/* HORIZONTAL RULES
=============================================================================*/

hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  border-bottom: 4px solid #ddd;
  padding: 0;
}

/* TABLES
=============================================================================*/

table th {
  font-weight: bold;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 6px 13px;
}

table tr {
  border-top: 1px solid #ccc;
  background-color: #fff;
}

table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

/* IMAGES
=============================================================================*/

img {
  max-width: 100%
}
</style>
</head>
<body>
<h2>Spring Boot 简介</h2>
<h3>Spring Boot 是什么</h3>
<p>Spring Boot从最根本上来讲，就是一些库的集合，其目的是用来简化新Spring应用的初始搭建以及开发过程，特性如下：</p>
<ol>
<li>创建独立的Spring应用程序</li>
<li>嵌入的Tomcat，无需部署WAR文件</li>
<li>使用启动器简化Maven配置</li>
<li>自动配置Spring</li>
<li>提供生产就绪型功能，如指标，健康检查</li>
<li>没有对XML配置要求</li>
</ol>
<p>环境要求：</p>
<ul>
<li>JDK版本（1.6，官方推荐1.8）</li>
<li>Apache Maven（3.2.3）</li>
</ul>
<h3>Spring Boot 之 Hello world</h3>
<ol>
<li>创建一个Maven项目</li>
<li>在<code>pom.xml</code>中添加Spring Boot依赖</li>
</ol>
<pre><code>&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;1.5.2.RELEASE&lt;/version&gt;
&lt;/parent&gt;
</code></pre>
<p>官方推荐项目继承于<code>spring-boot-starter-parent</code>，<code>spring-boot-starter-parent</code>包含了以下默认配置：</p>
<ul>
<li>使用java6编译级别</li>
<li>使用utf-8编码</li>
<li>实现了通用的测试框架</li>
<li>智能资源过滤</li>
<li>插件配置</li>
</ul>
<blockquote>
<p>如果项目有自己的继承关系，也可使用非继承的配置方式，详见官方说明文档：<a href="http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-maven-without-a-parent">【13.2.2 Using Spring Boot without the parent POM】</a></p>
</blockquote>
<p>配置启动器：</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p><code>spring-boot-starter-web</code>声明依赖一个封装的web项目的启动器，其中包含了多项依赖配置：</p>
<pre><code>&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
        &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
        &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<p>其他常用启动器有：</p>
<ul>
<li><code>spring-boot-starter</code>：Spring Boot的核心启动器</li>
<li><code>spring-boot-starter-web</code>：用于创建包括：RESTful、Spring MVC的web应用，并植入Tomcat作为默认的容器</li>
<li><code>spring-boot-starter-jdbc</code>：用于使用Tomcat JDBC连接池的应用</li>
<li><code>spring-boot-starter-data-jpa</code>：用于使用Hibernate实现Spring Data JPA数据访问层和跨存储的持久层功能的应用</li>
<li><code>spring-boot-starter-data-redis</code>：用于使用Spring Data Redis和Jedis客户端操作键-值存储的Redis</li>
<li><code>spring-boot-starter-data-mongodb</code>：用于使用基于文本数据库MongoDB和Spring Data MongoDB</li>
<li><code>spring-boot-starter-freemarker</code>：用于使用FreeMarker模板引擎构建Spring MVC web应用</li>
<li><code>spring-boot-starter-amqp</code>：用于使用Spring AMQP和Rabbit MQ的应用</li>
<li>......</li>
</ul>
<blockquote>
<p>官方提供40余种启动，更多启动器信息，见官方说明文档：<a href="http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-starter">【13.5 Starters】</a></p>
</blockquote>
<ol start="3">
<li>编写启动类</li>
</ol>
<p>在<code>default package</code>下创建<code>App.java</code></p>
<pre><code>@RestController
@SpringBootApplication
public class App {

    @RequestMapping(&quot;/&quot;)
    public Object home(){
        return &quot;Hello world!&quot;;
    }

    public static void main( String[] args ){
        SpringApplication springApp = new SpringApplication(App.class);
        springApp.run(args);
    }
}
</code></pre>
<p>注解说明：</p>
<p><code>@RestController</code>：等价于<code>@Controller</code>+<code>@ResponseBody</code></p>
<p><code>@SpringBootApplication</code>：等价于<code>@Configuration</code> + <code>@ComponentScan</code> + <code>@EnableAutoConfiguration</code></p>
<p><code>@Configuration</code>：<code>Spring</code>的配置注解，声明在类名上来注册<code>Bean</code>，通常与<code>@Bean</code>搭配使用</p>
<p><code>@ComponentScan</code>：即Spring mvc配置文件中的<code>&lt;context:component-scan/&gt;</code>标签，扫描这个类所在以及以下包路径的所有组件，如：<code>@Component</code>，<code>@Service</code>，<code>@Repository</code>等，并注册为<code>Spring</code>的<code>Bean</code>，可使用<code>@ComponentScan(&quot;com.eayun&quot;)</code>指定扫描路径。官方建议的项目目录结构如下：</p>
<pre><code>com
 +- example
     +- myproject
         +- Application.java
         |
         +- domain
         |   +- Customer.java
         |   +- CustomerRepository.java
         |
         +- service
         |   +- CustomerService.java
         |
         +- web
             +- CustomerController.java
</code></pre>
<p><code>@EnableAutoConfiguration</code>：使用<code>Spring Boot</code>自动配置，加载<code>spring-boot-autoconfigure-1.5.2.RELEASE.jar</code>下<code>META-INF/spring.factories</code>文件中的<code>org.springframework.boot.autoconfigure.*</code>属性</p>
<pre><code># Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\
org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\
org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\
org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\
......
</code></pre>
<ol start="4">
<li>运行程序</li>
</ol>
<ul>
<li>方式一：直接运行<code>main</code>方法</li>
</ul>
<p>在浏览器中输入：http://localhost:8080，出现<code>Hello world!</code></p>
<ul>
<li>方式二：打包运行</li>
</ul>
<p>需要修改<code>pom.xml</code>，添加构建项目所需要的插件：</p>
<pre><code>&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
</code></pre>
<p>在项目路径下运行命令<code>mvn package</code>，完成后在项目的target路径下，会生成 <code>[项目名]-0.0.1-SNAPSHOT.jar</code> 的jar包，在运行命令<code>java -jar [项目名]-0.0.1-SNAPSHOT.jar</code>启动项目，启动完成后，在浏览器中输入:http://localhost:8080，出现<code>Hello world!</code></p>
<p><b>附 Spring Boot启动日志：</b></p>
<pre><code>  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v1.5.2.RELEASE)

2017-03-13 10:49:44.670  INFO 7624 --- [           main] com.eayun.spring_boot.App                : Starting App on zengbo-pc with PID 7624 (E:\EclipseWorkspacePersonal\spring-boot\target\classes started by Administrator in E:\EclipseWorkspacePersonal\spring-boot)
2017-03-13 10:49:44.672  INFO 7624 --- [           main] com.eayun.spring_boot.App                : No active profile set, falling back to default profiles: default
2017-03-13 10:49:44.722  INFO 7624 --- [           main] ationConfigEmbeddedWebApplicationContext : Refreshing org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@4c93a753: startup date [Mon Mar 13 10:49:44 GMT+08:00 2017]; root of context hierarchy
2017-03-13 10:49:45.855  INFO 7624 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat initialized with port(s): 8080 (http)
2017-03-13 10:49:45.864  INFO 7624 --- [           main] o.apache.catalina.core.StandardService   : Starting service Tomcat
2017-03-13 10:49:45.865  INFO 7624 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/8.5.11
2017-03-13 10:49:45.935  INFO 7624 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2017-03-13 10:49:45.935  INFO 7624 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 1215 ms
2017-03-13 10:49:46.058  INFO 7624 --- [ost-startStop-1] o.s.b.w.servlet.ServletRegistrationBean  : Mapping servlet: 'dispatcherServlet' to [/]
2017-03-13 10:49:46.061  INFO 7624 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'characterEncodingFilter' to: [/*]
2017-03-13 10:49:46.062  INFO 7624 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'hiddenHttpMethodFilter' to: [/*]
2017-03-13 10:49:46.062  INFO 7624 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'httpPutFormContentFilter' to: [/*]
2017-03-13 10:49:46.062  INFO 7624 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'requestContextFilter' to: [/*]
2017-03-13 10:49:46.327  INFO 7624 --- [           main] s.w.s.m.m.a.RequestMappingHandlerAdapter : Looking for @ControllerAdvice: org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@4c93a753: startup date [Mon Mar 13 10:49:44 GMT+08:00 2017]; root of context hierarchy
2017-03-13 10:49:46.385  INFO 7624 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/]}&quot; onto public java.lang.Object com.eayun.spring_boot.App.home()
2017-03-13 10:49:46.389  INFO 7624 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/error]}&quot; onto public org.springframework.http.ResponseEntity&lt;java.util.Map&lt;java.lang.String, java.lang.Object&gt;&gt; org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.servlet.http.HttpServletRequest)
2017-03-13 10:49:46.389  INFO 7624 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/error],produces=[text/html]}&quot; onto public org.springframework.web.servlet.ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse)
2017-03-13 10:49:46.419  INFO 7624 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/webjars/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2017-03-13 10:49:46.419  INFO 7624 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2017-03-13 10:49:46.457  INFO 7624 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**/favicon.ico] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2017-03-13 10:49:46.646  INFO 7624 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup
2017-03-13 10:49:46.696  INFO 7624 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http)
2017-03-13 10:49:46.700  INFO 7624 --- [           main] com.eayun.spring_boot.App                : Started App in 2.321 seconds (JVM running for 2.537)
</code></pre>
<h3>Spring Boot 启动过程</h3>
<h4>SpringApplication初始化</h4>
<pre><code>public SpringApplication(Object... sources) {
    initialize(sources);
}

@SuppressWarnings({ &quot;unchecked&quot;, &quot;rawtypes&quot; })
private void initialize(Object[] sources) {
    if (sources != null &amp;&amp; sources.length &gt; 0) {
        this.sources.addAll(Arrays.asList(sources));
    }
    this.webEnvironment = deduceWebEnvironment();
    setInitializers((Collection) getSpringFactoriesInstances(
            ApplicationContextInitializer.class));
    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));
    this.mainApplicationClass = deduceMainApplicationClass();
}
</code></pre>
<p>从上面可以看出，初始化方法主要做了以下事情：</p>
<ol>
<li>初始化参数</li>
<li>判断是否为<code>WEB</code>项目，判断规则<code>deduceWebEnvironment()</code>如下：</li>
</ol>
<pre><code>private boolean deduceWebEnvironment() {
    for (String className : WEB_ENVIRONMENT_CLASSES) {
        if (!ClassUtils.isPresent(className, null)) {
            return false;
        }
    }
    return true;
}
</code></pre>
<p>遍历<code>WEB_ENVIRONMENT_CLASSES</code>集合，如果在<code>classpath</code>中所有的集合元素都存在，则表明是<code>WEB</code>项目；</p>
<pre><code>private static final String[] WEB_ENVIRONMENT_CLASSES = { &quot;javax.servlet.Servlet&quot;,
        &quot;org.springframework.web.context.ConfigurableWebApplicationContext&quot; };
</code></pre>
<p>查找<code>javax.servlet.Servlet</code>，发现是在jar是在<code>\.m2\repository\org\apache\tomcat\embed\tomcat-embed-core\8.5.11</code></p>
<ol start="3">
<li>加载<code>META-INF/spring.factories</code>中的初始化类和监听器</li>
<li>获取主类<code>Class</code></li>
</ol>
<h4>run()方法</h4>
<p>启动方法：<code>run()</code></p>
<pre><code>public ConfigurableApplicationContext run(String... args) {
    StopWatch stopWatch = new StopWatch();
    stopWatch.start();
    ConfigurableApplicationContext context = null;
    FailureAnalyzers analyzers = null;
    configureHeadlessProperty();
    SpringApplicationRunListeners listeners = getRunListeners(args);
    listeners.starting();
    try {
        ApplicationArguments applicationArguments = new DefaultApplicationArguments(
                args);
        ConfigurableEnvironment environment = prepareEnvironment(listeners,
                applicationArguments);
        Banner printedBanner = printBanner(environment);
        context = createApplicationContext();
        analyzers = new FailureAnalyzers(context);
        prepareContext(context, environment, listeners, applicationArguments,
                printedBanner);
        refreshContext(context);
        afterRefresh(context, applicationArguments);
        listeners.finished(context, null);
        stopWatch.stop();
        if (this.logStartupInfo) {
            new StartupInfoLogger(this.mainApplicationClass)
                    .logStarted(getApplicationLog(), stopWatch);
        }
        return context;
    }
    catch (Throwable ex) {
        handleRunFailure(context, listeners, analyzers, ex);
        throw new IllegalStateException(ex);
    }
}
</code></pre>
<p><b>代码分析</b></p>
<pre><code>SpringApplicationRunListeners listeners = getRunListeners(args);
listeners.starting();
</code></pre>
<p>使用<code>SpringApplicationRunListeners</code>对启动过程进行监听</p>
<pre><code>ApplicationArguments applicationArguments = new DefaultApplicationArguments(args);
</code></pre>
<p>使用启动参数初始化<code>ApplicationArguments</code>对象</p>
<pre><code>ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments);
</code></pre>
<p>配置SpringBoot应用的环境</p>
<pre><code>Banner printedBanner = printBanner(environment);
</code></pre>
<p>启动时控制台打印Spring标志</p>
<pre><code>analyzers = new FailureAnalyzers(context);
</code></pre>
<p>构建错误分析器</p>
<pre><code>context = createApplicationContext();

protected ConfigurableApplicationContext createApplicationContext() {
    Class&lt;?&gt; contextClass = this.applicationContextClass;
    if (contextClass == null) {
        try {
            contextClass = Class.forName(this.webEnvironment
                    ? DEFAULT_WEB_CONTEXT_CLASS : DEFAULT_CONTEXT_CLASS);
        }
        catch (ClassNotFoundException ex) {
            throw new IllegalStateException(
                    &quot;Unable create a default ApplicationContext, &quot;
                            + &quot;please specify an ApplicationContextClass&quot;,
                    ex);
        }
    }
    return (ConfigurableApplicationContext) BeanUtils.instantiate(contextClass);
}

public static final String DEFAULT_WEB_CONTEXT_CLASS = &quot;org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext&quot;;

public static final String DEFAULT_CONTEXT_CLASS = &quot;org.springframework.context.annotation.AnnotationConfigApplicationContext&quot;;
</code></pre>
<p>创建<code>ApplicationContext</code>，如果是<code>WEB</code>应用，创建<code>AnnotationConfigEmbeddedWebApplicationContext</code>类型的<code>Context</code>，否则创建<code>AnnotationConfigApplicationContext</code>的类型</p>
<pre><code>prepareContext(context, environment, listeners, applicationArguments, printedBanner);
</code></pre>
<p>对<code>context</code>进行初始化操作</p>
<pre><code>refreshContext(context);
</code></pre>
<p>整个Spring Boot应用启动过程中最核心的步骤，创建WEB容器和IOC容器，并把所需要的Bean注册到IOC容器中。注解<code>@EnableAutoConfiguration</code>就在这一步中起作用，Spring Boot是如何进行自动化配置的呢？以<code>MongoAutoConfiguration</code>为例：</p>
<pre><code>@Configuration
@ConditionalOnClass(MongoClient.class)
@EnableConfigurationProperties(MongoProperties.class)
@ConditionalOnMissingBean(type = &quot;org.springframework.data.mongodb.MongoDbFactory&quot;)
public class MongoAutoConfiguration {

    @Autowired
    private MongoProperties properties;

    @Autowired(required = false)
    private MongoClientOptions options;

    @Autowired
    private Environment environment;

    private MongoClient mongo;

    @PreDestroy
    public void close() {
        if (this.mongo != null) {
            this.mongo.close();
        }
    }

    @Bean
    @ConditionalOnMissingBean
    public MongoClient mongo() throws UnknownHostException {
        this.mongo = this.properties.createMongoClient(this.options, this.environment);
        return this.mongo;
    }
}
</code></pre>
<p>说明：</p>
<p><code>@ConditionalOnClass(MongoClient.class)</code></p>
<p><code>@ConditionalOnMissingBean(type = &quot;org.springframework.data.mongodb.MongoDbFactory&quot;)</code></p>
<p>当在<code>classpath</code>中存在<code>MongoClient.class</code>，并且在spring的context中不存在<code>MongoDbFactory</code>类型的bean，则触发<code>MongoAutoConfiguration</code>配置，否则忽略；</p>
<p><code>@EnableConfigurationProperties(MongoProperties.class)</code></p>
<p>读取在<code>application.properties</code>文件中关于<code>mongo</code>的属性配置，并注入到spring容器</p>
<pre><code>@ConfigurationProperties(prefix = &quot;spring.data.mongodb&quot;)
public class MongoProperties {
    ......
}

# MONGODB (MongoProperties)
spring.data.mongodb.authentication-database= # Authentication database name.
spring.data.mongodb.database=test # Database name.
spring.data.mongodb.field-naming-strategy= # Fully qualified name of the FieldNamingStrategy to use.
spring.data.mongodb.grid-fs-database= # GridFS database name.
spring.data.mongodb.host=localhost # Mongo server host. Cannot be set with uri.
spring.data.mongodb.password= # Login password of the mongo server. Cannot be set with uri.
spring.data.mongodb.port=27017 # Mongo server port. Cannot be set with uri.
spring.data.mongodb.repositories.enabled=true # Enable Mongo repositories.
spring.data.mongodb.uri=mongodb://localhost/test # Mongo database URI. Cannot be set with host, port and credentials.
spring.data.mongodb.username= # Login user of the mongo server. Cannot be set with uri.
</code></pre>
<p><code>@ConditionalOnMissingBean</code>
表示在spring的context中不存在<code>MongoClient</code>类型的bean时，触发<code>mongo()</code>方法，该方法返回一个<code>MongoClient</code>实例，并使用<code>@Bean</code>注入到spring容器</p>
<h3>Spring Boot 的配置文件</h3>
<p>Spring Boot配置文件名为：<code>application.properties</code>（也可以是后缀为：.yml的文件，其内容格式不同），配置文件中可配置各种框架的相关参数，如：mvc、logging、server等，关于配置文件中对框架的属性配置，请参考：<a href="http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#common-application-properties">【Appendix A. Common application properties】</a></p>
<h4>配置文件加载</h4>
<p>当项目启动时，SpringApplication会从以下地方加载<code>application.properties</code>：</p>
<ol>
<li>命令行当前目录下的<code>/config</code>子目录中的<code>application.properties</code>;</li>
<li>命令行当前目录下的<code>application.properties</code>;</li>
<li>项目classpath下的<code>/config</code>中的<code>application.properties</code>;</li>
<li>项目classpath根目录下的<code>application.properties</code>;</li>
</ol>
<p><b>注：以上顺序按照加载优先级由高到低排列</b></p>
<h4>配置文件中属性的读取</h4>
<p>推荐使用<code>@ConfigurationProperties</code>注解（另一种读取方式为<code>@Value(${&quot;属性名称&quot;})</code>），通过属性绑定类，将配置文件中的属性与类属性进行绑定，并且支持轻绑定，如<code>myconfig.jdbc.userName</code>属性，在配置文件中以一下各种方式书写，Spring Boot都可识别：</p>
<p><code>myconfig.jdbc.userName</code>（驼峰）<br />
<code>myconfig.jdbc.user_name</code>（下划线）<br />
<code>myconfig.jdbc.user-name</code>（短横线）<br />
<code>MYCONFIG_JDBC_USER_NAME</code>（全部大写+下划线）</p>
<p>如在<code>application.properties</code>中有以下自定义属性：</p>
<pre><code>#my own configure
myconfig.name = myconfig
myconfig.description = This is my configuration.
myconfig.jdbc.url = jdbc:mysql://localhost:3306/test
myconfig.jdbc.userName = root
myconfig.jdbc.password = root
</code></pre>
<p>创建一个类来绑定这些属性：</p>
<pre><code>import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.stereotype.Component;

@Component
@ConfigurationProperties(prefix = &quot;myconfig&quot;)
public class MyConfigProperties {
    
    private String name;
    
    private String description;
    
    private Jdbc jdbc = new Jdbc();
    
    public Jdbc getJdbc() {
        return jdbc;
    }

    public void setJdbc(Jdbc jdbc) {
        this.jdbc = jdbc;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public static class Jdbc {
        
        private String url;
        
        private String userName;
        
        private String password;

        public String getUrl() {
            return url;
        }

        public void setUrl(String url) {
            this.url = url;
        }

        public String getUserName() {
            return userName;
        }

        public void setUserName(String userName) {
            this.userName = userName;
        }

        public String getPassword() {
            return password;
        }

        public void setPassword(String password) {
            this.password = password;
        }
    }
}
</code></pre>
<h3>Spring Boot 静态资源路径</h3>
<p>Spring Boot 默认将<code>/</code>映射到项目<code>classpath:/</code>下的几个目录，分别是：<code>/static</code>、<code>/public</code>、<code>/resources</code>、<code>/META-INF/resources</code>，优先级为：<code>/META-INF/resources</code>&gt;<code>/resources</code>&gt;<code>/static</code>&gt;<code>/public</code></p>
<h4>自定义映射路径</h4>
<ol>
<li>通过更改<code>application.properties</code>属性，通过这种方式更改映射路径，会覆盖默认配置，即默认配置不会生效：</li>
</ol>
<pre><code>#资源映射路径为/content/**
spring.mvc.static-path-pattern=/content/**
#资源映射地址为classpath:/content/
spring.resources.static-locations=classpath:/content/ 
</code></pre>
<ol start="2">
<li>通过继承<code>WebMvcConfigurerAdapter</code>类，重写<code>addResourceHandlers()</code>，这种方式是在默认基础上添加映射路径：</li>
</ol>
<pre><code>@Configuration
public class MyMvcConfiguration extends WebMvcConfigurerAdapter {

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        //可添加多个，根据先后顺序，优先级逐渐降低
        registry.addResourceHandler(&quot;/content/**&quot;).addResourceLocations(&quot;classpath:/content/&quot;);
        registry.addResourceHandler(&quot;/img/**&quot;).addResourceLocations(&quot;file:D:/img/&quot;);
        super.addResourceHandlers(registry);
    }

}
</code></pre>
<h4>webjars</h4>
<p>什么是webjars？在web开发中，前端框架越来越多，webjars就是借助Maven将前端框架资源进行统一的管理，保证了资源的唯一性。默认配置<code>/webjars/**</code>是映射到<code>classpath:/META-INF/resources/webjars/</code>。</p>
<p>在<code>pom.xml</code>中添加jquery依赖：</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.webjars&lt;/groupId&gt;
    &lt;artifactId&gt;jquery&lt;/artifactId&gt;
    &lt;version&gt;3.1.1-1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>页面引用：</p>
<pre><code>&lt;script type=&quot;text/javascript&quot; src=&quot;/webjars/jquery/3.1.1-1/jquery.js&quot;&gt;&lt;/script&gt;
</code></pre>

</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
