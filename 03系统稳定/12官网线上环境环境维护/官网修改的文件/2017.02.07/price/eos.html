<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>易云捷讯-企业云上易云</title>
<link href="/style/style.css" type="text/css" rel="stylesheet"/>

<#assign name ="catalogTag">
<#assign catalogTag =newTag("${name}")>
</head>

<body>
<#include "/wwwroot/yymh/template/common/top.html">
<#include "/wwwroot/yymh/template/common/header.html"> 


<table width="1200" border="0" cellspacing="0" cellpadding="0" class="warp1200 paddingbt20">
	<tr>
    	<td>
		<h2 class="jiage_title">产品价格</h2>
        </td>
    </tr>
    <tr>
        <td width="212" valign="top" class="jiage_nav">
			<ul>
				<#assign catalog=catalogTag("{'levels':'self','name':'402890e758434aaa01584368b45c00aa'}")>
					<#if catalog?exists>
						<li><span><a class="yzj_left" href="${catalog.url!'javascript:void(0);'}">云主机</a></span></li>
					</#if>
					<#assign catalog=catalogTag("{'levels':'self','name':'402890e758434aaa01584369eec500ae'}")>
					<#if catalog?exists>
						<li><span><a class="yyp_left" href="${catalog.url!'javascript:void(0);'}">云硬盘</a></span></li>
					</#if>
					<#assign catalog=catalogTag("{'levels':'self','name':'402890e758434aaa0158436c26ac00bc'}")>
					<#if catalog?exists>
						<li><span><a class="yypkz_left" href="${catalog.url!'javascript:void(0);'}">云硬盘快照</a></span></li>
					</#if>
					<#assign catalog=catalogTag("{'levels':'self','name':'402890e758434aaa0158436cbb8a00c0'}")>
					<#if catalog?exists>
						<li><span><a class="sywl_left" href="${catalog.url!'javascript:void(0);'}">私有网络</a></span></li>
					</#if>
					<!-- <#assign catalog=catalogTag("{'levels':'self','name':'402890e758434aaa0158436af1bc00b6'}")>
					<#if catalog?exists>
						<li><span><a class="fzjh_left" href="${catalog.url!'javascript:void(0);'}">负载均衡</a></span></li>
					</#if> -->
					<#assign catalog=catalogTag("{'levels':'self','name':'402890e758434aaa0158436a7d7c00b2'}")>
					<#if catalog?exists>
						<li><span><a class="txgw_left" href="${catalog.url!'javascript:void(0);'}">弹性公网IP</a></span></li>
					</#if>
					<!-- <#assign catalog=catalogTag("{'levels':'self','name':'402890e758434aaa0158436d49b400c4'}")>
					<#if catalog?exists>
						<li><span><a class="vpn_left" href="${catalog.url!'javascript:void(0);'}">VPN</a></span></li>
					</#if> -->
					<#assign catalog=catalogTag("{'levels':'self','name':'402890e758434aaa0158436b622b00ba'}")>
					<#if catalog?exists>
						<li class="current"><span><a class="dxcc_left" href="${catalog.url!'javascript:void(0);'}">对象存储</a></span></li>
					</#if>
			</ul>
		</td>
        <td width="676" valign="top" class="jiage_content">
        	<table width="100%" border="0" cellspacing="0" cellpadding="0">
            	<div class="jiage_top">
                	<div class="jiage_top_title">
                		<span class="biaoti1">对象存储</span>
                		<span class="jiage_price">￥<span class="sum">0</span></span>
                        <div class="clear"></div>
                    </div>
                    <div class="jiage_top_button clearfix">
                        <button type="button" class="cancel">取消更改</button>
                        <button type="button" class="save">保存</button>
                        <button type="button" class="last_button view">加入预览</button>
                        <div class="clear"></div>
                    </div>
                </div>
                <div class="jiage_xinxi">
                	<ul class="dxcc_title">
                    	<li>数据中心</li>
                    </ul>
                    <ul>
                    	<li class="data_center">
                        	<span class="jiage_label">数据中心:</span>
                        </li>
                    </ul>
                	<ul class="dxcc_title">
                    	<li>存储空间</li>
                    </ul>
                    <ul>
                    	<li class="paddinglf30">
                        	<div class="dxcc_select">
                            <span></span>
                                <input type="text" value="1" class="dxcc_input1 space" id="space"/><select class="dxcc_select1 spaceSelect">
                                    <option>GB</option>
                                    <option>TB</option>
                                </select>
                            </div>
                        </li>
                    </ul>
                	<ul class="dxcc_title">
                    	<li>下行流量</li>
                    </ul>
                    <ul>
                    	<li class="paddinglf30">
                        	<div class="dxcc_select">
                                <span></span>
                                <input type="text" value="1" class="dxcc_input1 flow" id="flow"/><select  class="dxcc_select1 flowSelect">
                                    <option>GB</option>
                                    <option>TB</option>
                                </select>
                            </div>
                        </li>
                    </ul>
                	<ul class="dxcc_title">
                    	<li>请求次数</li>
                    </ul>
                    <ul>
                    	<li class="paddinglf30">
                        	<input class="dxcc_input request" type="number" max="10000000" min="0"/>  万次
                        </li>
                    </ul>
                	<ul class="dxcc_title">
                    	<li>CDN单日下载流量</li>
                    </ul>
                    <ul>
                    	<li class="paddinglf30">
                        	<div class="dxcc_select">
                                <span></span>
                                <input type="text" class="dxcc_input1 download"/><select  class="dxcc_select1 downloadSelect">
                                    <option>GB</option>
                                    <option>TB</option>
                                </select>
                            </div>
                        </li>
                    </ul>
                	<ul class="dxcc_title">
                    	<li>CDN使用天数</li>
                    </ul>
                    <ul>
                    	<li class="paddinglf30">
                        	<input class="dxcc_input days" max="10000000" type="number" min="0"/>
                        </li>
                    </ul>
                </div>
            </table>
		</td>
        <td width="10">&nbsp;</td>
        <td width="289" valign="top" class="jiage_view">
        	<div class="jiege_view_top">
            	<h4>价格预览</h4>
                <span>￥<span class="total_price">0</span></span>
            </div>
        </td>
    </tr>
</table>
<#include "/wwwroot/${sitePath}/template/common/foot_content.html">

<!--js部分-->
<script type="text/javascript" src="/script/jquery.min.js"></script>
<script type="text/javascript" src="/script/header.js"></script>
<script type="text/javascript" src="/script/jquery.cookie.js"></script>
<script type="text/javascript" src="/script/priceModul.js"></script>
<script>
	$(document).ready(function(e) {
        var price = new EayunPrice();
        function FormData (_data) {
            var data = _data || {
                dataCenter: 'bj',
                space: 1,
                spaceSelect: 'GB',
                flow: 1,
                flowSelect: 'GB',
                request: 1,
                download: 0,
                downloadSelect: 'GB',
                days: 0,
                purchase: 'eos'
            };

            data.id = new Date().getTime();

            this.getData = function () {
                return data;
            }
        }

        function total(){
        	var total = 0;
	    	for(i=0;i<$(".jiage_view_content").length;i++){
	        	var strLength = $(".jiage_view_content").eq(i).find(".edit_sum").text().length;
	        	total += parseFloat($(".jiage_view_content").eq(i).find(".edit_sum").text().substr(1, strLength));
	        }
        	$(".total_price").html(total.toFixed(3));
        };


        FormData.prototype.attr = function (attr,value) {
            var data = this.getData();

            if(value === undefined){
                return data[attr];
            }else{
                if(data.hasOwnProperty(attr)){
                    data[attr] = value;
                    $('.sum').text(this.getPriceEos());
                }
            }
        };

        FormData.prototype.getPriceEos = function(argument){
            var data = this.getData(),preview = price.getPriceEos(data);
            return (preview).toFixed(3);
            
        };

        FormData.prototype.createView = function(){
            var template = '<ul class="jiage_view_content">'+
                            '<p>对象存储<span class="edit_sum"></span><div class="clear"></div></p>'+
                            '<li class="edit_data"></li>'+
                            '<li class="edit_space"></li>'+
                            '<li class="edit_flow"></li>'+
                            '<li class="edit_request"></li>'+
                            '<li class="edit_download"></li>'+
                            '<li class="edit_days"></li>'+
                            '<li class="jiage_edit"><span class="edit"></span><span class="delete"></span></li>'+
                        '</ul>';
            var view = $(template),data = this.getData();
            view.attr('id','id'+data.id);
            view.find('.edit_sum').text('￥'+ this.getPriceEos());
            view.find('.edit_data').text('数据中心：'+ price.getDataCenterByCode(data.dataCenter).name);
            view.find('.edit_space').text('存储空间：'+ data.space + data.spaceSelect);
            view.find('.edit_flow').text('下行流量：'+ data.flow + data.flowSelect);
            view.find('.edit_request').text('请求次数：'+ data.request + '万次');
            view.find('.edit_download').text('CDN单日下载流量：'+ data.download + data.downloadSelect);
            view.find('.edit_days').text('CDN使用天数：'+ data.days);
            return view;
        };


        FormData.prototype.renderForm = function(){
            var data = this.getData(),that = this;

            var dataCenterDom = $('.data_center'),
                dataCenter = price.getDataCenter();
            dataCenterDom.find('.jiage_mark').remove();
            $.each(dataCenter,function(index, element) {
                var span = $('<span class="jiage_mark"></span>');
                span.text(element.name);
                span.attr('data-code',element.code);
                span.click(function () {
                    dataCenterDom.find('.current').removeClass('current');
                    span.addClass('current');
                    that.attr('dataCenter',element.code);
                });
                dataCenterDom.append(span);
                if(element.code == data.dataCenter){
                    span.click();
                }
            });


            $('.space').val(that.attr('space'));
            $('.spaceSelect').val(that.attr('spaceSelect'));
            $('.flow').val(that.attr('flow'));
            $('.flowSelect').val(that.attr('flowSelect'));
            $('.request').val(that.attr('request'));
            $('.download').val(that.attr('download'));
            $('.downloadSelect').val(that.attr('downloadSelect'));
            $('.days').val(that.attr('days'));
        };



        $('.space').blur(function(){
            data.attr('space',parseInt($(this).val()));
        });

        $('.spaceSelect').change(function() {
            if($(this).val() == 'TB'){
                if (parseInt($('.space').val())>10000000){
                    $('.space').val(10000000);
                    data.attr('space',$('.space').val());
                }
            }
            data.attr('spaceSelect',$(this).val());
        });

        $('.flow').blur(function(){
            data.attr('flow',parseInt($(this).val()));
        });

        $('.flowSelect').change(function() {
            if($(this).val() == 'TB'){
                if (parseInt($('.flow').val())>10000000){
                    $('.flow').val(10000000);
                    data.attr('flow',$('.flow').val());
                }
            }
            data.attr('flowSelect',$(this).val());

        });

        $('.request').blur(function(){
            data.attr('request',parseInt($(this).val()));
        });

        $('.download').blur(function(){
            data.attr('download',parseInt($(this).val()));
        });
        $('.downloadSelect').change(function() {
            if($(this).val() == 'TB'){
                if (parseInt($('.download').val())>10000000){
                    $('.download').val(10000000);
                    data.attr('download',$('.download').val());
                }
            }
            data.attr('downloadSelect',$(this).val());
        });

        $('.days').blur(function(){
            data.attr('days',parseInt($(this).val()));
        });

        $("input").keyup(function() {
            this.value=this.value.replace(/[^\d]/g,'');
            if ($(this).val()==''){
                $(this).val(0);
            }
        });

        $(".space").keyup(function() {
            if(data.attr('spaceSelect') == 'GB'){
                if (parseInt($(this).val())>10000000000){
                    $(this).val(10000000000);
                }
            }else{
                if (parseInt($(this).val())>10000000){
                    $(this).val(10000000);
                }
            }
            data.attr('space',$(this).val());
        });

        

        $(".flow").keyup(function() {
            if(data.attr('flowSelect') == 'GB'){
                if (parseInt($(this).val())>10000000000){
                    $(this).val(10000000000);
                }
            }else{
                if (parseInt($(this).val())>10000000){
                    $(this).val(10000000);
                }
            }
            data.attr('flow',$(this).val());
        });

        $(".download").keyup(function() {
            if(data.attr('downloadSelect') == 'GB'){
                if (parseInt($(this).val())>10000000000){
                    $(this).val(10000000000);
                }
            }else{
                if (parseInt($(this).val())>10000000){
                    $(this).val(10000000);
                }
            }
            data.attr('download',$(this).val());
        });

        $(".request").keyup(function() {
            if (parseInt($(this).val())>10000000){
                $(this).val(10000000);
            }
            data.attr('request',$(this).val());
        });

        $(".days").keyup(function() {
            if (parseInt($(this).val())>10000000){
                $(this).val(10000000);
            }
            data.attr('days',$(this).val());
        });


        var data = new FormData(),dataArray = JSON.parse($.cookie("eosview") || '[]');
        data.renderForm();


        function edit(i){
            $(".jiage_view_content").eq(i).addClass("detail_edit");
            $(".jiage_view_content").eq(i).find(".edit").css("background-position","bottom left");
            $(".edit").hide();
            $(".delete").hide();
            $(".cancel").fadeIn();
            $(".save").fadeIn();
            $(".view").hide();

            if ($(".detail_edit").children(".edit_buy_message").text().indexOf("月")!=-1){
                $(".purchase span").removeClass("current");
                $(".purchase span").eq(0).addClass("current");
                $('#progress').parent().show();
            }else if($(".detail_edit").children(".edit_buy_message").text().indexOf("时")!=-1){
                $(".purchase span").removeClass("current");
                $(".purchase span").eq(1).addClass("current");
                $('#progress').parent().hide();
            }

            data = new FormData(dataArray[i]);
            data.renderForm();
            $.cookie("eosview",JSON.stringify(dataArray));
        }

        function deleted(i){
            dataArray.splice(i,1);
            $.cookie("eosview",JSON.stringify(dataArray));
            drawView();
            total();
        }


        $(".view").click(function() {

            var view = data.createView(),i = dataArray.length;

            view.find('.edit').click(function () {
                edit(i);
            });

            $('.jiage_view').append(view);

            view.find(".delete").click(function() {
                deleted(i);
            });

            dataArray.push(data.getData());
            data = new FormData($.extend({},data.getData()));
            data.renderForm();
            $.cookie("eosview",JSON.stringify(dataArray));
            total();
        });


        $('.save').click(function(){

            $(".save").hide();
            $(".cancel").hide();
            $(".view").fadeIn();
            $(".edit").fadeIn();
            $(".delete").fadeIn();
            $(".jiage_view_content").removeClass("detail_edit");
            $(".jiage_view_content .edit").fadeIn().css("background-position","top left");

            $.cookie("eosview",JSON.stringify(dataArray));
            data = new FormData();
            data.renderForm();
            drawView();
            total();
        });

        $(".cancel").click(function() {
            $(".jiage_view_content").removeClass("detail_edit");
            $(".cancel").hide();
            $(".save").hide();
            $(".view").fadeIn();
            $(".edit").fadeIn().css("background-position","top left");
            $(".delete").fadeIn();
            data = new FormData();
            data.renderForm();

            dataArray = JSON.parse($.cookie("eosview") || '[]');
            
        });

        function drawView(){
            $('.jiage_view_content').remove();
            $.each(dataArray,function (index,element){
                var _data = new FormData(element),
                    view = _data.createView();
                view.find('.edit').click(function () {
                    edit(index);
                });

                $('.jiage_view').append(view);

                view.find(".delete").click(function() {
                    deleted(index);
                });
            });
        }

        drawView();
        total();
    });
</script>
</body>
</html>
